fname='Old_Glory7.ct';
fid=fopen(fname,'r');
ct=fread(fid,[256 3],'uint8');
fclose(fid);
a=[0:255];
figure(1)
imagesc(a)
colormap(ct/256);

figure(2)
plot(ct(:,1),'r');
hold on
plot(ct(:,2),'b');
plot(ct(:,3),'g');
hold off
cts=ct;
cts(:,1)=smooth(ct(:,1));
cts(:,2)=smooth(ct(:,2));
cts(:,3)=smooth(ct(:,3));
hold on 
plot(cts(:,1),'r:');
plot(cts(:,2),'b:');
plot(cts(:,3),'g:');
hold off

iname='IcePalette.tab';
fid=fopen(iname,'w');
for k=0:255
  disp(sprintf('%d %5.1f %5.1f %5.1f', k,cts(k+1,:)));
  fprintf(fid,'%d %5.1f %5.1f %5.1f\n', k,cts(k+1,:));
end
fclose(fid);

%%%%%%%%%

red = [  0, 57, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98,100,102,104,106,108,110,112,114,116,108,101, 94, 87, 79, 72, 65, 58, 50, 43, 36, 29, 21, 14,  7,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,120,127,135,142,150,157,165,172,180,187,195,202,210,217,225,232,240,247,255,255,  5,255,  0,  0, 14, 14, 34, 34, 34, 51, 51, 51, 70, 70, 70, 87, 87, 87,106,106,106,123,123,123,142,142,142,159,159,159,178,178,178,195,195,195,207,207,207,216,216,216,226,226,237,237,237,246,246,246,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,  2,  2, 32, 56, 72, 82, 87, 92, 98,103,108,112,117,123,128,134,140,146,152,157,161,165,167,169,170,169,167,165,161,157,152,147,142,138,134,130,126,123,120,118,116,115,114,114,114,114,115,116,117,118,118,119,120,120,121,122,123,124,126,127,130,132,135,139,143,147,153,161,165,168,170,172,174,175,177,179,181,184,184,184,184,184,184,184,184,255,255 ]';

grn= [  0, 69, 69, 69, 70, 70, 71, 71, 71, 72, 72, 73, 73, 73, 74, 74, 75, 75, 75, 76, 76, 77, 77, 77, 78, 78, 79, 79, 79, 80, 80, 81, 82, 83, 84, 86, 87, 88, 90, 91, 92, 94, 95, 96, 98, 99,100,102,111,121,130,140,149,159,168,178,187,197,206,216,225,235,244,254,254,254,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,255,253,253,255,254,  0,  2,  2,  4,  4,  4,  7,  7,  7, 10, 10, 10, 12, 12, 12, 15, 15, 15, 17, 17, 17, 20, 20, 20, 23, 23, 23, 25, 25, 25, 28, 28, 28, 41, 41, 41, 58, 58, 58, 77, 77, 97, 97, 97,114,114,114,131,131,131,138,138,138,146,146,146,153,153,153,161,161,161,168,168,168,176,176,176,183,183,183,191,191,191,198,198,198,206,206,206,213,213,  0,  0,  3,  6,  9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99,102,105,108,111,114,117,120,123,126,129,132,136,139,143,147,151,155,159,163,167,172,177,183,190,197,203,208,219,224,223,217,211,208,205,201,198,194,191,190,186,177,170,168,168,168,168,168,168,168,168,255,255]';

blu= [  0,105,101, 98, 94, 91, 87, 84, 80, 77, 74, 70, 67, 63, 60, 56, 53, 50, 46, 43, 39, 36, 32, 29, 26, 22, 19, 15, 12,  8,  5,  2,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,255, 32,255, 32,  0,251,251,246,246,246,241,241,241,236,236,236,232,232,232,227,227,227,223,223,223,218,218,218,213,213,213,208,208,208,204,204,204,187,187,187,168,168,168,146,146,125,125,125,106,106,106, 86, 86, 86, 78, 78, 78, 70, 70, 70, 63, 63, 63, 55, 55, 55, 48, 48, 48, 39, 39, 39, 32, 32, 32, 24, 24, 24, 17, 17, 17,  9,  9,  9,  1,  1, 93, 93,  6, 11, 16, 19, 22, 25, 28, 31, 35, 38, 42, 46, 50, 54, 58, 62, 66, 71, 76, 83, 90, 98,106,114,123,130,138,144,151,156,162,166,171,175,179,183,187,191,194,197,200,202,205,207,209,211,212,214,216,217,218,218,219,219,220,220,221,221,222,223,223,222,222,221,220,219,218,217,215,215,214,214,215,216,217,219,219,219,219,219,219,219,219,255,255 ]';

pal=[red grn blu];
fid=fopen('OldGlory.tab','w');
for k=1:256
  fprintf(fid,'%d %d %d %d\n',k,red(k),grn(k),blu(k));
end
fclose(fid);

land=pal(1:83,:);
ocean=pal(88:168,:)

figure(3)
plot(land(:,1),'r');
hold on
plot(land(:,2),'b');
plot(land(:,3),'g');
hold off
land(1,:)=land(2,:);
land(83,1)=254;
ct=land;
cts=ct;
cts(:,1)=smooth(smooth(smooth(smooth(ct(:,1)))));
cts(:,2)=smooth(smooth(smooth(smooth(ct(:,2)))));
cts(:,3)=smooth(smooth(smooth(smooth(ct(:,3)))));
hold on 
plot(cts(:,1),'r:');
plot(cts(:,2),'b:');
plot(cts(:,3),'g:');
hold off
title('land');

landct=pal*0+255;
landct(:,1)=interp1(([1:length(cts(:,1))]-1)*256/length(cts(:,1)),cts(:,1),[0:255]');
landct(:,2)=interp1(([1:length(cts(:,2))]-1)*256/length(cts(:,2)),cts(:,2),[0:255]');
landct(:,3)=interp1(([1:length(cts(:,3))]-1)*256/length(cts(:,3)),cts(:,3),[0:255]');
landct(253,3)=0;
landct(isnan(landct)==1)=255;
landct(1,:)=0;
figure(13)
colormap(landct/255);
a=[0:255];
imagesc(a);

figure(23)
plot(landct(:,1),'r');
hold on
plot(landct(:,2),'b');
plot(landct(:,3),'g');
hold off
title('final land');


iname='LandPalette.tab';
fid=fopen(iname,'w');
for k=0:255
  disp(sprintf('%d %5.1f %5.1f %5.1f', k,landct(k+1,:)));
  fprintf(fid,'%d %5.1f %5.1f %5.1f\n', k,landct(k+1,:));
end
fclose(fid);


figure(4)
plot(ocean(:,1),'r');
hold on
plot(ocean(:,2),'b');
plot(ocean(:,3),'g');
hold off
ocean(1,:)=ocean(2,:);
ct=ocean;
cts=ct;
cts(:,1)=smooth(smooth(smooth(ct(:,1))));
cts(:,2)=smooth(smooth(smooth(ct(:,2))));
cts(:,3)=smooth(smooth(smooth(ct(:,3))));
hold on 
plot(cts(:,1),'r:');
plot(cts(:,2),'b:');
plot(cts(:,3),'g:');
hold off

oceanct=pal*0+255;
oceanct(:,1)=interp1(([1:length(cts(:,1))]-1)*256/length(cts(:,1)),cts(:,1),[0:255]');
oceanct(:,2)=interp1(([1:length(cts(:,2))]-1)*256/length(cts(:,2)),cts(:,2),[0:255]');
oceanct(:,3)=interp1(([1:length(cts(:,3))]-1)*256/length(cts(:,3)),cts(:,3),[0:255]');
oceanct(253,3)=0;
oceanct(isnan(oceanct)==1)=255;
oceanct(1,:)=0;
figure(14)
colormap(oceanct/255);
a=[0:255];
imagesc(a);

figure(24)
plot(oceanct(:,1),'r');
hold on
plot(oceanct(:,2),'b');
plot(oceanct(:,3),'g');
hold off
title('final ocean');

oname='OceanPalette.tab';
fid=fopen(oname,'w');
for k=0:255
  disp(sprintf('%d %5.1f %5.1f %5.1f', k,oceanct(k+1,:)));
  fprintf(fid,'%d %5.1f %5.1f %5.1f\n', k,oceanct(k+1,:));
end
fclose(fid);
